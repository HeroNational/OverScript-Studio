# What's Next - OverScript Studio

## üéØ Fonctionnalit√©s Planifi√©es

### 1. Extraction de Sous-titres YouTube ‚≠ê (PRIORIT√â 1)

#### Objectif
Permettre d'importer automatiquement les sous-titres d'une vid√©o YouTube en collant simplement l'URL.

#### Fonctionnalit√©s D√©taill√©es

**1.1 Extraction des Sous-titres**
- Coller un lien YouTube (format court ou long)
- D√©tecter automatiquement l'ID de la vid√©o
- R√©cup√©rer les sous-titres disponibles (auto-g√©n√©r√©s ou manuels)
- Supporter plusieurs langues
- T√©l√©charger au format texte nettoy√© (sans timestamps)

**1.2 Formats de Liens Support√©s**
- `https://www.youtube.com/watch?v=VIDEO_ID`
- `https://youtu.be/VIDEO_ID`
- `https://www.youtube.com/watch?v=VIDEO_ID&t=123s`
- `https://m.youtube.com/watch?v=VIDEO_ID`

**1.3 S√©lection de Langue**
- Liste automatique des langues disponibles
- Pr√©f√©rence pour les sous-titres manuels vs auto-g√©n√©r√©s
- Option pour t√©l√©charger plusieurs langues

**1.4 Interface Utilisateur**
- Champ de texte pour coller l'URL YouTube
- Bouton "Extraire les sous-titres"
- Loading indicator pendant le t√©l√©chargement
- Liste d√©roulante pour s√©lectionner la langue
- Badge indiquant "Auto" ou "Manuel" pour chaque langue

#### Architecture Technique

```dart
// Structure de donn√©es propos√©e
class YouTubeSubtitle {
  final String videoId;
  final String videoTitle;
  final List<SubtitleTrack> tracks;
  final String? thumbnailUrl;

  YouTubeSubtitle({
    required this.videoId,
    required this.videoTitle,
    required this.tracks,
    this.thumbnailUrl,
  });
}

class SubtitleTrack {
  final String language;
  final String languageCode;
  final bool isAutoGenerated;
  final String text;

  SubtitleTrack({
    required this.language,
    required this.languageCode,
    required this.isAutoGenerated,
    required this.text,
  });
}
```

#### Service d'Extraction

```dart
class YouTubeSubtitleService {
  /// Extrait l'ID de la vid√©o depuis l'URL
  String? extractVideoId(String url) {
    final regexPatterns = [
      RegExp(r'(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\?\/]+)'),
      RegExp(r'youtube\.com\/embed\/([^&\?\/]+)'),
    ];

    for (final pattern in regexPatterns) {
      final match = pattern.firstMatch(url);
      if (match != null) return match.group(1);
    }
    return null;
  }

  /// R√©cup√®re les informations de la vid√©o
  Future<YouTubeSubtitle> fetchSubtitles(String videoId) async {
    // Utiliser youtube_explode_dart pour r√©cup√©rer les sous-titres
    final yt = YoutubeExplode();

    try {
      final video = await yt.videos.get(videoId);
      final manifest = await yt.videos.closedCaptions.getManifest(videoId);

      final tracks = <SubtitleTrack>[];
      for (final track in manifest.tracks) {
        final captions = await yt.videos.closedCaptions.get(track);
        final text = _cleanSubtitles(captions);

        tracks.add(SubtitleTrack(
          language: track.language.name,
          languageCode: track.language.code,
          isAutoGenerated: track.isAutoGenerated,
          text: text,
        ));
      }

      return YouTubeSubtitle(
        videoId: videoId,
        videoTitle: video.title,
        tracks: tracks,
        thumbnailUrl: video.thumbnails.mediumResUrl,
      );
    } finally {
      yt.close();
    }
  }

  /// Nettoie les sous-titres (retire timestamps, etc.)
  String _cleanSubtitles(ClosedCaptionManifest captions) {
    final lines = <String>[];
    for (final caption in captions.captions) {
      final text = caption.text
          .replaceAll(RegExp(r'\[.*?\]'), '') // Retire [Musique], etc.
          .replaceAll(RegExp(r'\(.*?\)'), '') // Retire (rires), etc.
          .trim();

      if (text.isNotEmpty) {
        lines.add(text);
      }
    }
    return lines.join('\n');
  }
}
```

#### Interface dans SourcesDialog

**Nouveau Bouton:**
```dart
_SourceOption(
  icon: LucideIcons.youtube,
  title: 'Vid√©o YouTube',
  subtitle: 'Importer les sous-titres depuis un lien',
  gradientColors: const [Color(0xFFFF0000), Color(0xFFCC0000)],
  onTap: () async {
    final controller = TextEditingController();

    await showDialog(
      context: context,
      builder: (context) => YouTubeSubtitleDialog(
        controller: controller,
        onSubtitleSelected: (text) {
          Navigator.pop(context);
          onSourceSelected(SourceData(text: text));
        },
      ),
    );
  },
)
```

**Dialog d'Extraction:**
```dart
class YouTubeSubtitleDialog extends StatefulWidget {
  final TextEditingController controller;
  final Function(String) onSubtitleSelected;

  // ... UI avec:
  // - TextField pour l'URL
  // - Bouton "Extraire"
  // - Loading indicator
  // - Liste des langues disponibles
  // - Preview du texte
}
```

#### Packages Requis

```yaml
dependencies:
  # Extraction YouTube
  youtube_explode_dart: ^2.2.1

  # HTTP pour les requ√™tes
  http: ^1.2.0

  # Parsing HTML si n√©cessaire
  html: ^0.15.4
```

#### Impl√©mentation par Phases

**Phase 1: Extraction Basique (2-3 jours)**
- Int√©grer `youtube_explode_dart`
- Cr√©er `YouTubeSubtitleService`
- Ajouter validation d'URL
- Extraire sous-titres dans la langue par d√©faut

**Phase 2: S√©lection de Langue (1-2 jours)**
- Afficher toutes les langues disponibles
- Permettre la s√©lection
- Distinguer auto-g√©n√©r√©s vs manuels

**Phase 3: UI Avanc√©e (2-3 jours)**
- Dialog √©l√©gant avec preview
- Affichage de la miniature vid√©o
- Titre de la vid√©o
- Indicateurs de chargement

**Phase 4: Optimisations (1-2 jours)**
- Mise en cache des sous-titres
- Gestion d'erreurs robuste
- Messages d'erreur clairs
- Support des playlists (bonus)

#### Gestion des Erreurs

```dart
enum YouTubeSubtitleError {
  invalidUrl,
  videoNotFound,
  noSubtitlesAvailable,
  networkError,
  rateLimited,
}

class YouTubeSubtitleException implements Exception {
  final YouTubeSubtitleError error;
  final String message;

  YouTubeSubtitleException(this.error, this.message);
}
```

#### Consid√©rations Techniques

**Permissions:**
- Acc√®s Internet requis
- Pas de permissions suppl√©mentaires n√©cessaires

**Limitations:**
- YouTube peut bloquer les requ√™tes excessives
- Certaines vid√©os n'ont pas de sous-titres
- Les sous-titres auto-g√©n√©r√©s peuvent contenir des erreurs

**Solutions:**
- Impl√©menter un rate limiting
- Cache local pour √©viter les requ√™tes r√©p√©t√©es
- Messages d'erreur explicites

#### S√©curit√© & Vie Priv√©e

- Aucune donn√©e utilisateur envoy√©e
- Requ√™tes directes √† l'API YouTube publique
- Pas de tracking
- Option pour d√©sactiver le cache des sous-titres

---

### 2. Synchronisation Voix-Texte (Priorit√© Haute)

#### Objectif
Permettre au prompteur de suivre automatiquement la lecture en se synchronisant avec la voix de l'utilisateur.

#### Fonctionnalit√©s D√©taill√©es

**1.1 Capture Audio**
- Utiliser le microphone pour capter la voix de l'utilisateur en temps r√©el
- Package Flutter recommand√©: `speech_to_text` ou `flutter_sound`
- Support macOS, Windows, Linux

**1.2 Reconnaissance Vocale**
- Conversion voix ‚Üí texte en temps r√©el (STT - Speech-to-Text)
- Options d'impl√©mentation:
  - **Option A**: API locale (plus rapide, offline)
    - macOS: Speech Framework natif
    - Windows: Windows Speech Recognition
    - Multiplateforme: Vosk, Whisper.cpp
  - **Option B**: API Cloud (plus pr√©cis)
    - Google Cloud Speech-to-Text
    - Azure Speech Services
    - OpenAI Whisper API

**1.3 Algorithme de Synchronisation**
- Matcher le texte reconnu avec le contenu du prompteur
- Techniques possibles:
  - **Fuzzy matching** (distance de Levenshtein)
  - **N-gram matching** pour tol√©rer les erreurs de reconnaissance
  - **Fen√™tre glissante** pour suivre la progression

**1.4 D√©filement Automatique Adaptatif**
- Ajuster la vitesse de d√©filement en fonction du rythme de lecture
- Calculer la vitesse moyenne de lecture (mots/minute)
- Acc√©l√©ration/ralentissement fluide sans √†-coups

**1.5 Indicateur Visuel**
- Surligner le mot/phrase en cours de lecture
- Afficher une barre de progression synchronis√©e
- Indicateur de confiance de la reconnaissance vocale

#### Architecture Technique

```dart
// Structure de donn√©es propos√©e
class VoiceSyncState {
  bool isListening;
  double confidence;        // Confiance de la reconnaissance (0-1)
  int currentWordIndex;     // Position actuelle dans le texte
  double readingSpeed;      // Vitesse en mots/minute
  List<SyncedWord> words;   // Mots avec timestamps
}

class SyncedWord {
  String text;
  int startIndex;
  int endIndex;
  DateTime timestamp;
  double confidence;
}
```

#### Impl√©mentation par Phases

**Phase 1: Reconnaissance Vocale Basique**
- Int√©grer `speech_to_text`
- Afficher le texte reconnu en temps r√©el
- Bouton pour activer/d√©sactiver l'√©coute

**Phase 2: Matching Simple**
- Comparer le texte reconnu avec le contenu
- D√©tecter la position approximative
- D√©filement manuel vers la position d√©tect√©e

**Phase 3: Synchronisation Avanc√©e**
- Suivi en temps r√©el
- D√©filement automatique adaptatif
- Gestion des pauses et reprises

**Phase 4: Optimisations**
- Mise en cache des patterns fr√©quents
- Calibration personnalis√©e par utilisateur
- Support multilingue

#### Param√®tres Utilisateur √† Ajouter

```dart
// Dans SettingsModel
class VoiceSyncSettings {
  bool enableVoiceSync;           // Activer/d√©sactiver
  String recognitionLanguage;     // Langue de reconnaissance
  double minimumConfidence;       // Seuil de confiance (0.5-1.0)
  bool highlightCurrentWord;      // Surligner le mot actuel
  bool autoScrollWithVoice;       // D√©filement automatique
  double syncSensitivity;         // R√©activit√© (0-1)
  bool showConfidenceIndicator;   // Afficher la confiance
}
```

#### Interface Utilisateur

**Nouveaux Contr√¥les dans la Toolbox:**
- Bouton micro (activer/d√©sactiver l'√©coute)
- Indicateur LED pour l'√©tat de reconnaissance
- Affichage de la confiance de synchronisation

**Nouveau Panneau de Param√®tres:**
- Section "Synchronisation Vocale"
  - Toggle activation
  - S√©lection de la langue
  - Slider de sensibilit√©
  - Calibration du micro
  - Test de reconnaissance

#### D√©fis Techniques

1. **Latence**: Minimiser le d√©lai entre voix et synchronisation
2. **Pr√©cision**: G√©rer les accents, bruits de fond, erreurs de prononciation
3. **Performance**: Traitement temps r√©el sans ralentir l'UI
4. **Permissions**: Acc√®s micro sur macOS/Windows/Linux
5. **Offline vs Online**: Balance entre pr√©cision et vie priv√©e

#### Packages Flutter Recommand√©s

```yaml
dependencies:
  # Reconnaissance vocale
  speech_to_text: ^7.0.0

  # Alternative pour plus de contr√¥le
  flutter_sound: ^9.11.3

  # Matching de texte
  fuzzy: ^0.5.1

  # Analyse de similarit√©
  string_similarity: ^2.0.0

  # Permissions
  permission_handler: ^11.3.1
```

---

### 2. Autres Fonctionnalit√©s Futures

#### 2.1 Contr√¥le √† Distance
- T√©l√©commande mobile (smartphone comme remote)
- Support Bluetooth clavier/p√©dale
- Int√©gration avec Stream Deck

#### 2.2 Modes d'Affichage Avanc√©s
- Mode miroir (invers√© horizontalement pour utilisation avec miroir)
- Mode multi-√©cran (texte sur un √©cran, contr√¥les sur l'autre)
- Mode t√©l√©prompter pr√©sidentiel (deux √©crans lat√©raux)

#### 2.3 Collaboration
- Synchronisation multi-utilisateurs
- Annotations en temps r√©el
- Partage de scripts via cloud

#### 2.4 Analytiques
- Statistiques de lecture (dur√©e, vitesse moyenne)
- Historique des sessions
- Export des m√©triques

#### 2.5 Intelligence Artificielle
- Suggestions de reformulation
- D√©tection des pauses naturelles
- G√©n√©ration automatique de scripts √† partir de notes

#### 2.6 Accessibilit√©
- Support lecteur d'√©cran
- Contraste √©lev√©
- Agrandissement de zones sp√©cifiques

---

## üìù Notes d'Impl√©mentation

### ‚≠ê Priorit√© Imm√©diate: Extraction YouTube (1 semaine)

**Jour 1-2: Setup & Service de base**
- Ajouter `youtube_explode_dart` au pubspec.yaml
- Cr√©er `lib/data/services/youtube_subtitle_service.dart`
- Impl√©menter extraction d'ID vid√©o (regex)
- Tester avec quelques vid√©os

**Jour 3-4: UI & Int√©gration**
- Cr√©er `YouTubeSubtitleDialog` widget
- Ajouter bouton YouTube dans `sources_dialog.dart`
- Impl√©menter s√©lection de langue
- Gestion des √©tats (loading, error, success)

**Jour 5-7: Polissage & Tests**
- Am√©liorer l'UI (miniature, titre vid√©o)
- Gestion d'erreurs robuste
- Tests avec diff√©rents types de vid√©os
- Documentation

### Priorit√© Suivante: Synchronisation Vocale

**√âtape 1 (1-2 semaines)**
- Recherche et choix de la solution STT
- Proof of concept avec `speech_to_text`
- Tests de pr√©cision sur diff√©rents accents

**√âtape 2 (2-3 semaines)**
- Impl√©mentation du matching de texte
- Interface utilisateur pour les contr√¥les vocaux
- Tests avec diff√©rents types de contenu

**√âtape 3 (2-3 semaines)**
- Optimisation de la synchronisation
- Param√®tres utilisateur
- Tests utilisateurs r√©els

**√âtape 4 (1 semaine)**
- Documentation
- Tutoriel vid√©o
- Release beta

### Consid√©rations Techniques

**Permissions macOS:**
```xml
<!-- √Ä ajouter dans Info.plist -->
<key>NSMicrophoneUsageDescription</key>
<string>Le prompteur a besoin d'acc√©der au microphone pour synchroniser le d√©filement avec votre voix.</string>
```

**Permissions Windows/Linux:**
- G√©r√© automatiquement par `speech_to_text`

---

## üöÄ Roadmap

- [x] **v1.0** - Version actuelle (compl√®te)
  - ‚úÖ Prompteur de base
  - ‚úÖ Import TXT/PDF/SRT/VTT
  - ‚úÖ √âditeur riche (Quill)
  - ‚úÖ Toolbox glassmorphic
  - ‚úÖ Param√®tres complets
  - ‚úÖ Support macOS/Windows/Linux
- [ ] **v1.1** - ‚≠ê **Extraction YouTube** (PRIORIT√â 1 - 1 semaine)
  - Import sous-titres depuis URL YouTube
  - S√©lection de langue
  - UI avec preview
- [ ] **v1.2** - Synchronisation vocale basique (2-3 semaines)
  - Reconnaissance vocale
  - Suivi basique du texte
- [ ] **v1.3** - Synchronisation vocale avanc√©e + highlighting (2-3 semaines)
  - D√©filement adaptatif
  - Surlignage en temps r√©el
- [ ] **v1.4** - Contr√¥le √† distance (1-2 semaines)
  - Remote mobile
  - Support clavier/p√©dale
- [ ] **v2.0** - Features collaboratives et cloud (4-6 semaines)
  - Synchronisation multi-utilisateurs
  - Cloud storage
- [ ] **v2.5** - Intelligence artificielle (3-4 semaines)
  - Suggestions de reformulation
  - G√©n√©ration de scripts
- [ ] **v3.0** - Plateforme compl√®te (3-6 mois)
  - Version web
  - Applications mobiles (iOS/Android)

---

## üí° Id√©es en Vrac

- Mode "practice" avec enregistrement et playback
- Traduction en temps r√©el
- Support pour scripts avec notes/indications
- Int√©gration avec outils de pr√©sentation (PowerPoint, Keynote)
- Mode "confidence monitor" (affichage des diapositives suivantes)
- G√©n√©rateur de QR code pour partage rapide
- Support pour formats de scripts TV/cin√©ma (Fountain, Final Draft)

---

## üìö Ressources Utiles

### Documentation

**YouTube:**
- [youtube_explode_dart](https://pub.dev/packages/youtube_explode_dart)
- [YouTube API Reference](https://developers.google.com/youtube/v3)

**Speech Recognition:**
- [speech_to_text plugin](https://pub.dev/packages/speech_to_text)
- [Vosk Offline Recognition](https://alphacephei.com/vosk/)
- [OpenAI Whisper](https://github.com/openai/whisper)

### Inspiration
- [Teleprompter Premium (iOS)](https://apps.apple.com/us/app/teleprompter-premium/id448620076)
- [PromptSmart (Multi-platform)](https://promptsmart.com/)

### Algorithmes
- [Levenshtein Distance](https://en.wikipedia.org/wiki/Levenshtein_distance)
- [Smith-Waterman Algorithm](https://en.wikipedia.org/wiki/Smith%E2%80%93Waterman_algorithm)
- [Dynamic Time Warping](https://en.wikipedia.org/wiki/Dynamic_time_warping)

---

**Derni√®re mise √† jour:** 2025-11-29
**Mainteneur:** OverScript Studio Team
